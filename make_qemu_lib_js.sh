#!/bin/bash
echo "  LINK  qemu-img-lib.js" && emcc -m64 -fPIC -D_FORTIFY_SOURCE=2 -D_GNU_SOURCE -D_FILE_OFFSET_BITS=64 -D_LARGEFILE_SOURCE -Wstrict-prototypes -Wredundant-decls -Wall -Wundef -Wwrite-strings -Wmissing-prototypes -fno-strict-aliasing  -fno-stack-protector -Wendif-labels -Wmissing-include-dirs -Wempty-body -Wnested-externs -Wformat-security -Wformat-y2k -Winit-self -Wignored-qualifiers -Wold-style-definition -Wtype-limits    -g  -m64 -g  -shared  -s LINKABLE=1 -s BUILD_AS_SHARED_LIB=2 -s EXPORTED_FUNCTIONS="['_qemu_img_open', '_qemu_img_read', '_qemu_img_get_info']" -o qemu-img-lib.js aes.o aio.o async.o block.o block/blkdebug.o block/blkverify.o block/bochs.o block/cloop.o block/cow.o block/dmg.o block/nbd.o block/parallels.o block/qcow.o block/qcow2-cache.o block/qcow2-cluster.o block/qcow2-refcount.o block/qcow2-snapshot.o block/qcow2.o block/qed-check.o block/qed-cluster.o block/qed-gencb.o block/qed-l2-cache.o block/qed-table.o block/qed.o block/raw-posix.o block/raw.o block/vdi.o block/vmdk.o block/vpc.o block/vvfat.o cache-utils.o cutils.o error.o json-lexer.o json-parser.o json-streamer.o module.o nbd.o osdep.o oslib-posix.o posix-aio-compat.o qbool.o qdict.o qemu-config.o qemu-error.o qemu-img-lib.o qemu-malloc.o qemu-option.o qemu-progress.o qemu-thread-posix.o qemu-timer-common.o qemu-tool.o qerror.o qfloat.o qint.o qjson.o qlist.o qstring.o -lrt -pthread  -lz --pre-js qemu-pre.js
